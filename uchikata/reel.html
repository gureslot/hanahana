<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>リール操作テスト</title>

<style>
body{
  margin:0;
  background:#fff;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.reel-wrapper{
  display:flex;
  gap:2px;
}

.reel{
  height:693px; /* 21 * 33 */
  overflow:hidden;
  touch-action:none;
  user-select:none;
  -webkit-user-drag:none;
}

.track{
  will-change:transform;
}

.track img{
  display:block;
  user-select:none;
  -webkit-user-drag:none;
  pointer-events:none;
}
</style>
</head>

<body>

<div class="reel-wrapper">
  <div class="reel" data-src="../assets/reel_1_strip_21x33.png"></div>
  <div class="reel" data-src="../assets/reel_2_strip_21x33.png"></div>
  <div class="reel" data-src="../assets/reel_3_strip_21x33.png"></div>
</div>

<script>
const CELL_H = 33;
const CELLS = 21;
const STRIP_H = CELL_H * CELLS; // 693

function mod(n, m){
  return ((n % m) + m) % m;
}

document.querySelectorAll('.reel').forEach(reel=>{

  const src = reel.dataset.src;

  // 2枚並べる（ループ用）
  const track = document.createElement('div');
  track.className = 'track';

  const imgA = new Image();
  const imgB = new Image();

  imgA.src = src;
  imgB.src = src;

  track.appendChild(imgA);
  track.appendChild(imgB);
  reel.appendChild(track);

  let dragging = false;
  let startY = 0;
  let baseOffset = 0;   // 0..692 の範囲で管理
  let liveOffset = 0;

  function apply(offset){
    track.style.transform = `translateY(${-offset}px)`;
  }

  reel.addEventListener('pointerdown', e=>{
    dragging = true;
    startY = e.clientY;
    liveOffset = baseOffset;
    reel.setPointerCapture(e.pointerId);
  });

  reel.addEventListener('pointermove', e=>{
    if(!dragging) return;

    const dy = e.clientY - startY;

    // 指を上に動かす( dyマイナス ) → リールは上へ回す
    const raw = baseOffset + (-dy);

    liveOffset = mod(raw, STRIP_H);
    apply(liveOffset);
  });

  function endDrag(){
    if(!dragging) return;

    dragging = false;

    // 1コマ単位にスナップ
    const snapped = Math.round(liveOffset / CELL_H) * CELL_H;

    baseOffset = mod(snapped, STRIP_H);
    apply(baseOffset);
  }

  reel.addEventListener('pointerup', endDrag);
  reel.addEventListener('pointercancel', endDrag);

  // 初期表示
  apply(0);
});
</script>

</body>
</html>
