<!DOCTYPE html>

<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>リール配列確認</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#fff;
  color:#111;
}

.wrap{
  max-width:1100px;
  margin:40px auto;
  padding:0 20px;
  text-align:center;
}

h1{
  font-size:40px;
  margin:0 0 10px 0;
  letter-spacing:1px;
}

.desc{
  margin:0 0 30px 0;
  font-size:16px;
  color:#555;
}

.reel-wrapper{
  display:flex;
  gap:2px;
  justify-content:center;
}

.reel{
  height:1386px;              /* 33px * 42コマ */
  width:clamp(90px, 9vw, 120px); /* ここを詰めたり広げたりして調整 */
  overflow:hidden;
  touch-action:none;
  user-select:none;
  -webkit-user-drag:none;
}

.track{
  will-change:transform;
}

.track img{
  display:block;
  width:100%;
  height:auto;
  user-select:none;
  -webkit-user-drag:none;
  pointer-events:none;
}

.nav{
  display:flex;
  gap:20px;
  justify-content:center;
  flex-wrap:wrap;
  margin:40px 0 0 0;
}

.nav a{
  display:inline-block;
  padding:14px 28px;
  border:2px solid #ff2a6d;
  color:#111;
  text-decoration:none;
  border-radius:10px;
  transition:0.2s;
  font-size:18px;
  font-weight:bold;
}

.nav a:hover{
  background:#ff2a6d;
  color:#fff;
}

.copyright{
  margin:40px 0 20px 0;
  font-size:13px;
  color:#777;
}

@media(max-width:768px){
  h1{ font-size:30px; }
}
</style>

</head>

<body>

<div class="wrap">

  <h1>リール配列確認</h1>
  <p class="desc">ドラッグすると図柄を動かせます。</p>

  <div class="reel-wrapper">
    <div class="reel" data-src="../assets/reel_1_strip_21x33.png"></div>
    <div class="reel" data-src="../assets/reel_2_strip_21x33.png"></div>
    <div class="reel" data-src="../assets/reel_3_strip_21x33.png"></div>
  </div>

  <div class="nav">
    <a href="../index.html">index</a>
    <a href="../uchikata.html">ハナハナ打ち方紹介</a>
  </div>

  <div class="copyright">
    ©PIONEER CO.,LTD.
  </div>

</div>

<script>
const CELL_H = 33;
const CELLS = 21;         // 元画像のコマ数（帯のコマ数）
const VIEW_CELLS = 42;    // 表示したいコマ数（ここを変える）
const STRIP_H = CELL_H * CELLS;
const VIEW_H  = CELL_H * VIEW_CELLS;

// 表示窓(VIEW_H)に対して、下が空かないように必要枚数を自動計算
// 必要高さ = VIEW_H + STRIP_H なので、42コマなら3枚になる
const COPIES = Math.ceil((VIEW_H + STRIP_H) / STRIP_H);

function mod(n, m){
  return ((n % m) + m) % m;
}

document.querySelectorAll('.reel').forEach(reel=>{

  const src = reel.dataset.src;

  const track = document.createElement('div');
  track.className = 'track';

  for(let i=0; i<COPIES; i++){
    const img = new Image();
    img.src = src;
    track.appendChild(img);
  }

  reel.appendChild(track);

  let dragging = false;
  let startY = 0;
  let baseOffset = 0;
  let liveOffset = 0;

  function apply(offset){
    track.style.transform = `translateY(${-offset}px)`;
  }

  reel.addEventListener('pointerdown', e=>{
    dragging = true;
    startY = e.clientY;
    liveOffset = baseOffset;
    reel.setPointerCapture(e.pointerId);
  });

  reel.addEventListener('pointermove', e=>{
    if(!dragging) return;

    const dy = e.clientY - startY;
    const raw = baseOffset + (-dy);

    liveOffset = mod(raw, STRIP_H);
    apply(liveOffset);
  });

  function endDrag(){
    if(!dragging) return;

    dragging = false;

    const snapped = Math.round(liveOffset / CELL_H) * CELL_H;
    baseOffset = mod(snapped, STRIP_H);
    apply(baseOffset);
  }

  reel.addEventListener('pointerup', endDrag);
  reel.addEventListener('pointercancel', endDrag);

  apply(0);
});
</script>

</body>
</html>
